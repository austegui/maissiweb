---
phase: 11-notifications-real-time
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Supabase Realtime publication includes conversation_metadata, conversation_notes, conversation_contact_labels, and contacts tables"
    - "user_profiles table has a notifications_enabled BOOLEAN column defaulting to true"
  artifacts: []
  key_links: []
---

<objective>
Enable Supabase Realtime publication for the four metadata tables and add the notifications_enabled preference column to user_profiles.

Purpose: All subsequent plans in Phase 11 depend on these database-level prerequisites. Realtime subscriptions will not deliver events unless the tables are added to the `supabase_realtime` publication, and the notification toggle needs a persistent column.
Output: Database schema changes applied via Supabase Dashboard SQL Editor.
</objective>

<execution_context>
@C:\Users\Gustavo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Gustavo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-notifications-real-time/11-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Run SQL migration in Supabase Dashboard</name>
  <action>
    Run the following SQL in the Supabase Dashboard SQL Editor (single execution block):

    ```sql
    -- Enable Realtime publication for metadata tables
    ALTER PUBLICATION supabase_realtime ADD TABLE conversation_metadata;
    ALTER PUBLICATION supabase_realtime ADD TABLE conversation_notes;
    ALTER PUBLICATION supabase_realtime ADD TABLE conversation_contact_labels;
    ALTER PUBLICATION supabase_realtime ADD TABLE contacts;

    -- Add notification preference column to user_profiles
    ALTER TABLE user_profiles
      ADD COLUMN IF NOT EXISTS notifications_enabled BOOLEAN NOT NULL DEFAULT true;
    ```
  </action>
  <verify>
    After running the SQL, verify in the Supabase Dashboard:
    1. Go to Database > Publications > supabase_realtime — confirm all 4 tables are listed
    2. Go to Table Editor > user_profiles — confirm `notifications_enabled` column exists with default `true`
  </verify>
  <done>All four tables are in the supabase_realtime publication and user_profiles has the notifications_enabled column</done>
</task>

</tasks>

<verification>
- Supabase Dashboard > Database > Publications > supabase_realtime shows conversation_metadata, conversation_notes, conversation_contact_labels, contacts
- Supabase Dashboard > Table Editor > user_profiles shows notifications_enabled BOOLEAN column with default true
- Existing user rows have notifications_enabled = true (the DEFAULT fills them in)
</verification>

<success_criteria>
The database is ready for Realtime subscriptions and notification preferences. No code changes in this plan.
</success_criteria>

<output>
After completion, create `.planning/phases/11-notifications-real-time/11-01-SUMMARY.md`
</output>
