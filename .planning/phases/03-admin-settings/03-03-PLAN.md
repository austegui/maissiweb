---
phase: 03-admin-settings
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - src/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "The inbox header has a link to /admin/settings"
    - "The settings page loads on Vercel and shows the form"
    - "Saving a credential via the form persists the value in the Supabase app_settings table"
    - "The API key is shown as masked (last-4 only) after saving"
    - "Redeploying the app does not reset saved credential values"
  artifacts:
    - path: "src/app/page.tsx"
      provides: "Settings link in inbox header"
      contains: "/admin/settings"
  key_links:
    - from: "src/app/page.tsx"
      to: "/admin/settings"
      via: "anchor tag or Next.js Link"
      pattern: "admin/settings"
---

<objective>
Add a Settings link to the inbox header, push all Phase 3 code to GitHub, and verify the settings page works on the Vercel production deployment.

Purpose: This plan wires the settings page into the app navigation and confirms the complete Phase 3 feature works in production. Since the user cannot test locally, verification is done via the Vercel deployment at https://maissiweb.vercel.app/.

Output: Updated inbox header with Settings link, all Phase 3 code deployed to Vercel
</objective>

<execution_context>
@C:\Users\Gustavo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Gustavo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-admin-settings/03-01-SUMMARY.md
@.planning/phases/03-admin-settings/03-02-SUMMARY.md
@src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Settings link to inbox header and push to GitHub</name>
  <files>src/app/page.tsx</files>
  <action>
1. Edit src/app/page.tsx to add a Settings link in the header bar (the div with className="flex items-center justify-between border-b px-4 py-2"):
   - Add a link between the "WhatsApp Inbox" title and the "Sign out" form
   - Use an anchor tag or Next.js Link pointing to "/admin/settings"
   - Style: text-xs text-gray-500 hover:text-gray-700 (same style as the Sign out button)
   - Text: "Settings"

2. The header should now have three elements in a row:
   - Left: "WhatsApp Inbox" title
   - Right group: "Settings" link + "Sign out" button (with a small gap between them, e.g., flex items-center gap-3)

3. After editing, commit all Phase 3 files:
   - src/lib/get-config.ts (from 03-01)
   - src/app/api/settings/route.ts (from 03-01)
   - src/app/admin/settings/page.tsx (from 03-02)
   - src/app/admin/settings/actions.ts (from 03-02)
   - src/app/admin/settings/SettingsForm.tsx (from 03-02)
   - src/app/page.tsx (this task)

4. Push to origin (git push origin master) to trigger Vercel deployment.

Commit message: "feat(03): add admin settings page with getConfig utility"
  </action>
  <verify>
src/app/page.tsx contains a link to /admin/settings. All 6 Phase 3 files are committed. Push to origin succeeds. Vercel deployment starts.
  </verify>
  <done>Settings link visible in inbox header. All Phase 3 code pushed to GitHub and deploying on Vercel.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Admin settings page at /admin/settings with:
- Server Component that reads credentials from Supabase app_settings table
- Client Component form with 4 fields (API Key, Phone Number ID, WABA ID, WhatsApp API URL)
- Server Action that upserts credentials
- getConfig() utility for future Phase 4 use
- Settings link in inbox header
  </what-built>
  <how-to-verify>
1. Visit https://maissiweb.vercel.app/ — log in if needed
2. Verify "Settings" link appears in the inbox header (next to "Sign out")
3. Click "Settings" — you should be taken to /admin/settings
4. Verify the settings form loads with 4 fields:
   - API Key (password field, empty, with placeholder "Enter new value to update...")
   - Phone Number ID (text field)
   - WABA ID (text field)
   - WhatsApp API URL (text field, optional, with placeholder showing default URL)
5. Enter a test value for Phone Number ID (e.g., "test123") and click "Save Settings"
6. Verify "Settings saved successfully" message appears in green
7. Refresh the page — verify "test123" persists in the Phone Number ID field (DB-backed)
8. Verify the API Key shows "Not set" initially (or masked last-4 if a value exists)
9. Navigate back to inbox using the back link
10. (Optional) Check Supabase dashboard -> Table Editor -> app_settings to confirm row exists
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues you see</resume-signal>
</task>

</tasks>

<verification>
1. Settings link is visible in the inbox header at https://maissiweb.vercel.app/
2. /admin/settings loads and shows the credentials form
3. Saving a value persists it in the database (confirmed by page refresh)
4. API key display is masked (last-4 only or "Not set")
5. The settings page requires authentication (redirects to /login if not logged in)
</verification>

<success_criteria>
- Settings page is accessible from the inbox via a header link
- Credentials can be saved and persist across page refreshes (DB-backed)
- API key is never shown in full — masked display only
- All Phase 3 code is deployed and working on Vercel
</success_criteria>

<output>
After completion, create `.planning/phases/03-admin-settings/03-03-SUMMARY.md`
</output>
