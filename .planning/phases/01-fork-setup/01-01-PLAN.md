---
phase: 01-fork-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - .env.local
  - .gitignore
  - src/**
  - next.config.ts
  - tsconfig.json
  - tailwind.config.ts
  - postcss.config.mjs
  - components.json
autonomous: false

user_setup:
  - service: kapso
    why: "WhatsApp Cloud API credentials needed for .env.local"
    env_vars:
      - name: PHONE_NUMBER_ID
        source: "app.kapso.ai dashboard"
      - name: KAPSO_API_KEY
        source: "app.kapso.ai dashboard"
      - name: WABA_ID
        source: "app.kapso.ai dashboard"

must_haves:
  truths:
    - "Kapso source code exists in the working directory alongside .planning/"
    - "npm install completes without errors"
    - "Dev server starts on port 4000 without crash"
    - ".env.local exists with all required variables and is gitignored"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies and scripts"
      contains: "next dev"
    - path: "src/app/layout.tsx"
      provides: "Next.js App Router root layout"
    - path: "src/app/page.tsx"
      provides: "Main inbox UI page"
    - path: ".env.local"
      provides: "Local environment variables"
      contains: "KAPSO_API_KEY"
    - path: ".gitignore"
      provides: "Git ignore rules"
      contains: ".env*.local"
  key_links:
    - from: ".env.local"
      to: "src/lib/whatsapp-client.ts"
      via: "process.env reads at runtime"
      pattern: "process\\.env\\.KAPSO_API_KEY"
---

<objective>
Pull the Kapso WhatsApp Cloud Inbox source code into the kapsoweb working directory, install dependencies, configure the local environment, and verify the app starts.

Purpose: This is the foundation for all subsequent phases. No code can be audited, modified, or extended until the upstream source exists locally and runs.
Output: A working local development environment with the Kapso inbox running at http://localhost:4000
</objective>

<execution_context>
@C:\Users\Gustavo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Gustavo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-fork-setup/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pull Kapso source into working directory</name>
  <files>package.json, src/**, next.config.ts, tsconfig.json, tailwind.config.ts, postcss.config.mjs, components.json, .gitignore</files>
  <action>
The kapsoweb directory currently contains only `.planning/`, `.claude/`, and `.git/`. The Kapso source code must be pulled in WITHOUT destroying the existing git history or planning docs.

Strategy: Add the upstream repo as a temporary remote and merge its content.

Steps:
1. Add gokapso/whatsapp-cloud-inbox as a git remote named `upstream`:
   ```bash
   git remote add upstream https://github.com/gokapso/whatsapp-cloud-inbox.git
   ```

2. Fetch upstream:
   ```bash
   git fetch upstream
   ```

3. Merge upstream/main into the current branch, allowing unrelated histories:
   ```bash
   git merge upstream/main --allow-unrelated-histories -m "feat(01-01): merge upstream kapso whatsapp-cloud-inbox"
   ```
   If there are merge conflicts (unlikely since the working directory has no overlapping files), resolve by keeping both sides — .planning/ from local, everything else from upstream.

4. Verify the merge brought in the source code:
   ```bash
   ls src/app/layout.tsx src/lib/whatsapp-client.ts package.json
   ```

5. Verify `.gitignore` includes `.env*.local`. If NOT present, add this line:
   ```
   .env*.local
   ```

IMPORTANT: Do NOT use `git clone` — that would create a nested directory or wipe the existing repo. Use `git remote add` + `git merge` to bring code into the existing repo.
  </action>
  <verify>
Run all of these and confirm success:
```bash
ls src/app/layout.tsx  # Must exist
ls src/lib/whatsapp-client.ts  # Must exist
ls package.json  # Must exist
git remote -v  # Must show upstream pointing to gokapso/whatsapp-cloud-inbox
git log --oneline -5  # Must show merge commit + prior planning commits
grep -q ".env" .gitignore && echo "OK: .env covered" || echo "FAIL: .env not in gitignore"
```
  </verify>
  <done>
Kapso source code exists in `src/`, `package.json` exists, `.gitignore` covers `.env*.local`, upstream remote is configured, and the existing .planning/ directory is intact.
  </done>
</task>

<task type="auto">
  <name>Task 2: Install dependencies and configure local environment</name>
  <files>.env.local, package-lock.json</files>
  <action>
1. Install Node.js dependencies:
   ```bash
   npm install
   ```
   This project requires Node.js >= 20.19 (per @kapso/whatsapp-cloud-api requirement). If npm install fails with an engine error, the executor should note the Node version requirement in the summary.

2. Check if `.env.example` exists and use it as a template:
   ```bash
   cp .env.example .env.local
   ```
   If `.env.example` does not exist, create `.env.local` with this content:
   ```
   PHONE_NUMBER_ID=
   KAPSO_API_KEY=
   WABA_ID=
   ```

3. The user will need to fill in the actual credential values. Leave them blank for now — the checkpoint task will handle this.

4. Attempt to start the dev server to verify the build compiles:
   ```bash
   npx next dev --turbopack -p 4000
   ```
   The app may show errors in the browser about missing credentials, but the server itself should START without crashing. If the server starts (shows "Ready" or similar), that confirms the build is working. Stop the server after confirming it starts.

   NOTE: The app uses `npm run dev` which maps to `next dev --turbopack -p 4000`. Either command works.
  </action>
  <verify>
```bash
ls node_modules/.package-lock.json && echo "OK: node_modules exists"
ls .env.local && echo "OK: .env.local exists"
cat .env.local  # Should show the three env var names
npm run dev &  # Start in background
sleep 5
curl -s -o /dev/null -w "%{http_code}" http://localhost:4000 || echo "Server may need credentials to fully load"
kill %1 2>/dev/null  # Stop background server
```
  </verify>
  <done>
`node_modules/` is populated, `.env.local` exists with the required variable names, and `npm run dev` starts the Turbopack dev server on port 4000 without crashing.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Kapso WhatsApp Cloud Inbox source code has been merged into the kapsoweb project. Dependencies are installed and a `.env.local` file is ready for credentials.
  </what-built>
  <how-to-verify>
1. Fill in your Kapso credentials in `.env.local`:
   - Open `.env.local` in the project root
   - Set `PHONE_NUMBER_ID`, `KAPSO_API_KEY`, and `WABA_ID` with values from app.kapso.ai

2. Start the dev server:
   ```bash
   npm run dev
   ```

3. Open http://localhost:4000 in your browser

4. Verify the WhatsApp inbox UI loads (you should see the conversation list interface, even if no conversations exist yet)

5. Confirm `.planning/` directory still exists and has not been lost in the merge
  </how-to-verify>
  <resume-signal>Type "approved" if the inbox UI loads, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- `ls src/app/layout.tsx` exists (App Router source present)
- `ls src/lib/whatsapp-client.ts` exists (core lib present)
- `git remote -v` shows upstream -> gokapso/whatsapp-cloud-inbox
- `ls .planning/PROJECT.md` exists (planning docs preserved)
- `npm run dev` starts without crash on port 4000
- `.env.local` is gitignored (not tracked by git)
</verification>

<success_criteria>
The Kapso source code is in the working directory, dependencies are installed, the dev server starts on port 4000, and the user has confirmed the inbox UI loads in the browser. The existing .planning/ directory and git history are preserved.
</success_criteria>

<output>
After completion, create `.planning/phases/01-fork-setup/01-01-SUMMARY.md`
</output>
