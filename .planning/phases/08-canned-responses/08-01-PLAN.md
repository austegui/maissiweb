---
phase: 08-canned-responses
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "The canned_responses table exists in Supabase with columns id, title, shortcut (UNIQUE), body, created_at, updated_at"
    - "All authenticated users can SELECT from canned_responses"
    - "Only admin users can INSERT, UPDATE, DELETE canned_responses"
    - "RLS is enabled and policies use get_my_role() for admin checks"
  artifacts:
    - path: "Supabase Dashboard > SQL Editor"
      provides: "canned_responses table with RLS policies"
  key_links:
    - from: "canned_responses RLS policies"
      to: "public.get_my_role()"
      via: "SQL function call in policy USING/WITH CHECK"
      pattern: "get_my_role.*admin"
---

<objective>
Create the canned_responses Supabase table with RLS policies.

Purpose: The database table is the foundation for all canned response features -- admin CRUD and agent slash picker both depend on it.
Output: A working canned_responses table with team-shared read access and admin-only write access.
</objective>

<execution_context>
@C:\Users\Gustavo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Gustavo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-canned-responses/08-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Create canned_responses table and RLS policies in Supabase</name>
  <action>
Run the following SQL in the Supabase Dashboard SQL Editor (https://supabase.com/dashboard > SQL Editor):

```sql
CREATE TABLE public.canned_responses (
  id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title       TEXT NOT NULL,
  shortcut    TEXT NOT NULL UNIQUE,
  body        TEXT NOT NULL,
  created_at  TIMESTAMPTZ DEFAULT now(),
  updated_at  TIMESTAMPTZ DEFAULT now()
);

ALTER TABLE public.canned_responses ENABLE ROW LEVEL SECURITY;

-- All authenticated users can read
CREATE POLICY "All agents can read canned responses"
  ON public.canned_responses
  FOR SELECT
  TO authenticated
  USING ( true );

-- Only admins can create
CREATE POLICY "Only admins can insert canned responses"
  ON public.canned_responses
  FOR INSERT
  TO authenticated
  WITH CHECK ( (SELECT public.get_my_role()) = 'admin' );

-- Only admins can update
CREATE POLICY "Only admins can update canned responses"
  ON public.canned_responses
  FOR UPDATE
  TO authenticated
  USING ( (SELECT public.get_my_role()) = 'admin' )
  WITH CHECK ( (SELECT public.get_my_role()) = 'admin' );

-- Only admins can delete
CREATE POLICY "Only admins can delete canned responses"
  ON public.canned_responses
  FOR DELETE
  TO authenticated
  USING ( (SELECT public.get_my_role()) = 'admin' );
```

This reuses the `get_my_role()` function created in Phase 7 for consistent RBAC.
  </action>
  <verify>
In the Supabase Dashboard, go to Table Editor and confirm `canned_responses` appears with columns: id, title, shortcut, body, created_at, updated_at. Then go to Auth Policies and confirm 4 policies exist on the table.
  </verify>
  <done>The canned_responses table exists with RLS enabled, all authenticated users can SELECT, and only admins can INSERT/UPDATE/DELETE.</done>
  <resume-signal>Type "done" after running the SQL successfully</resume-signal>
</task>

</tasks>

<verification>
- Table visible in Supabase Dashboard Table Editor
- 4 RLS policies visible under Authentication > Policies for canned_responses
- shortcut column has UNIQUE constraint
</verification>

<success_criteria>
The canned_responses table is ready for Plans 02 and 03 to build CRUD and picker features on top of it.
</success_criteria>

<output>
After completion, create `.planning/phases/08-canned-responses/08-01-SUMMARY.md`
</output>
